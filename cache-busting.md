# 캐시 버스팅(Cache Busting) 전략 분석 및 제안

## 1. 캐시 버스팅이란?
브라우저나 CDN은 성능 향상을 위해 웹 페이지의 리소스(이미지, 스크립트, 스타일시트 등)를 저장(캐시)해 둡니다. 하지만 파일을 수정했을 때, 브라우저가 여전히 이전 버전의 파일을 캐시에서 불러와 화면이 갱신되지 않는 문제가 발생할 수 있습니다.
**캐시 버스팅**은 파일의 URL을 변경하여 브라우저가 강제로 새로운 리소스를 서버로부터 다시 받아오게 만드는 기법입니다.

## 2. PonPon 프로젝트 현황 분석

### 2.1 Next.js 빌드 파일 (JS/CSS) - ✅ 자동 적용됨
Next.js는 빌드 시 생성되는 JavaScript, CSS 파일명에 자동으로 해시값(예: `main-a1b2c3.js`)을 붙입니다.
- **상태**: 기본적으로 잘 처리되고 있음. 별도 작업 불필요.

### 2.2 Supabase 이미지 업로드 - ✅ 부분적 안전
`src/components/ImageUploader.tsx`를 확인한 결과, 이미지 업로드 시 매번 새로운 파일명을 생성합니다.
```typescript
const fileName = `${Date.now()}_${Math.random().toString(36).substring(7)}.webp`
```
- **상태**: 파일을 덮어쓰지 않고 항상 새로 만들기 때문에, **신규 업로드**된 이미지는 캐시 문제가 발생하지 않습니다.
- **잠재적 문제**: 만약 기존 파일명(URL)을 유지하면서 이미지만 교체(덮어쓰기)하고 싶은 경우, 사용자는 여전히 브라우저 캐시에 남아있는 이전 이미지를 보게 됩니다.

## 3. 캐시 버스팅 전략 제안

이미지 갱신이 즉시 반영되도록 하려면 URL 뒤에 의미 없는 쿼리 파라미터를 붙이는 전략을 사용합니다.

### 추천 전략: Query String (`?t=...` 또는 `?v=...`) 사용

이미지 URL 뒤에 버전이나 타임스탬프를 붙입니다.
- **형식**: `https://example.com/logo.webp?t=20240130`
- **장점**: 브라우저와 CDN 모두가 이를 "다른 요청"으로 인식하여 캐시를 무시하고 새 이미지를 받아옵니다.

### 사용자 요청 사항 검토 (`#v=??`)
사용자분께서 `#v=??` 형식을 언급하신 적이 있습니다.
- `https://.../image.webp#v=1`
- **주의**: URL의 `#`(해시) 뒷부분은 **서버로 전송되지 않습니다.** 브라우저 내부적으로만 처리되므로, 일부 CDN에서는 캐시 갱신이 트리거되지 않을 수 있습니다.
- **결론**: 확실한 캐시 갱신을 위해 **`#` 대신 `?` (물음표) 사용을 권장**합니다.

## 4. 적용 가이드

`GEMINI.md` 규칙이나 개발 시 아래 패턴을 따르길 권장합니다.

1. **이미지 교체 시**: 같은 URL을 유지해야 한다면, 사용하는 코드 쪽에서 URL 뒤에 버전을 붙인다.
   ```tsx
   <img src={`${imageUrl}?v=${version}`} />
   ```
2. **신규 업로드**: 현재 방식대로 Unique한 파일명을 사용하면 별도 파라미터 없이도 안전하다.
